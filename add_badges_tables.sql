-- Add ai_usage_count to usuarios
ALTER TABLE usuarios ADD COLUMN IF NOT EXISTS ai_usage_count INT DEFAULT 0;

-- Table for Badges Definitions
CREATE TABLE IF NOT EXISTS badges (
    id SERIAL PRIMARY KEY,
    name TEXT NOT NULL UNIQUE,
    description TEXT,
    icon TEXT, -- Emoji or short code
    category TEXT -- 'learning', 'lab', 'ai', 'general'
);

-- Table for User Badges
CREATE TABLE IF NOT EXISTS user_badges (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id BIGINT NOT NULL,
    badge_id INT REFERENCES badges(id),
    awarded_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE(user_id, badge_id)
);

-- Insert Default Badges
INSERT INTO badges (name, description, icon, category) VALUES
('Iniciado', 'Complet贸 el primer m贸dulo de entrenamiento.', '', 'learning'),
('Hacker Novato', 'Complet贸 3 m贸dulos de entrenamiento.', '', 'learning'),
('Script Kiddie', 'Complet贸 5 m贸dulos de entrenamiento.', '', 'learning'),
('White Hat', 'Complet贸 todos los m贸dulos de entrenamiento.', '', 'learning'),
('Explorador', 'Realiz贸 su primer escaneo de red en laboratorio.', '', 'lab'),
('Curioso', 'Realiz贸 10 consultas a la IA.', '', 'ai'),
('Investigador', 'Realiz贸 50 consultas a la IA.', '', 'ai')
ON CONFLICT (name) DO NOTHING;
